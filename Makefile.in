.DEFAULT_GOAL:=all

.PHONY: clean distclean all src/@PACKAGE_NAME@.cmxa install

example/example.native: src/@PACKAGE_NAME@.cmxa example/example.ml
	cd $(dir $@); @OCAMLBUILD@ -use-ocamlfind -package @OCAML_PKG_lablgtk2@ -lib $(shell pwd)/$(basename $<) -lflags -cclib,-L$(dir $(shell pwd)/$<) -cflags -I,$(dir $(shell pwd)/$<) $(notdir $@)

example/example.app: example/example.native example/info.plist
	rm -rf $@
	mkdir -p $@/Contents/MacOS
	cp example/example.native $@/Contents/MacOS
	cp example/info.plist $@/Contents

src/@PACKAGE_NAME@.cmxa:
	+${MAKE} -C src/ $(notdir $@)

install:
	@OCAMLFIND@ install @PACKAGE_NAME@ META src/*.mli src/@PACKAGE_NAME@.cm{,x}a src/dll@PACKAGE_NAME@.so src/gOSXApplication.cmi

all: src/@PACKAGE_NAME@.cmxa example/example.app

html: $(wildcard src/*.mli) $(wildcard src/*Enums.ml)
	rm -rf html && mkdir html
	@OCAMLFIND@ ocamldoc -I src -package @OCAML_PKG_lablgtk2@ -d $@ -html $^

clean:
	find . -name \*~ -delete
	+${MAKE} -C src/ clean
	cd example; @OCAMLBUILD@ -clean
	rm -rf example/example.app
	rm -rf html

distclean:
	rm -f META {,src/}Makefile example/info.plist config.{log,status}